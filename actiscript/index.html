<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AcTi ëŒ€ë³¸ë¶„ì„ - Aê¸‰ ì—°ê¸° ì½”ì¹­</title>

    <!-- Web App & Home Screen Icon Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AcTi ë¶„ì„">
    <link rel="apple-touch-icon" href="actiscript.png">
    <link rel="icon" href="actiscript.png" type="image/png">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiQWNUiSBTY3JpcHQgQW5hbHlzaXMiLCJzaG9ydF9uYW1lIjoiQWNUaSIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMTIxMjEyIiwidGhlbWVfY29sb3IiOiIjMTIxMjEyIiwiaWNvbnMiOlt7InNyYyI6ImFjdGlzY3JpcC5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn0seyJzcmMiOiJhY3Rpc2NyaXAucG5nIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">

    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* 1. Global Reset & Design System (Professional Theme v5) */
        :root {
            --bg-color: #121212;
            --card-bg-color: #1E1E1E;
            --input-bg-color: #2A2A2A;
            --primary-yellow: #FFD60A;
            --primary-red: #FF3B30;
            --text-color: #FFFFFF;
            --subtext-color: #A0A0A0;
            --border-color: #383838;
            --font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .app-container { max-width: 600px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }

        .screen-wrapper { flex-grow: 1; display: flex; flex-direction: column; }
        .screen { display: none; flex-direction: column; flex-grow: 1; }
        .screen.active { display: flex; }

        .btn {
            padding: 15px 20px; border: none; border-radius: 12px; font-size: 16px;
            font-weight: 700; cursor: pointer; transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%;
        }
        .btn:hover { transform: translateY(-2px); }

        .btn-primary { 
            background: linear-gradient(145deg, #ff4d43, #e6342a);
            color: var(--text-color); 
            box-shadow: 0 4px 15px rgba(255, 59, 48, 0.2);
        }
        .btn-primary:hover { box-shadow: 0 6px 20px rgba(255, 59, 48, 0.3); }
        .btn-primary:disabled { background: #444; color: #888; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .btn-back {
            background: none; border: none; color: var(--text-color);
            cursor: pointer; padding: 0; width: 44px; height: 44px; display: flex;
            align-items: center; justify-content: center; flex-shrink: 0;
        }
        
        .header-main { padding: 20px; }
        .app-container.loading-active .header-main { display: none; }
        .header-card {
            background-color: var(--card-bg-color); border: 1px solid var(--border-color);
            border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 15px;
            justify-content: center;
        }
        .header-main .logo-icon {
            width: 48px; height: 48px; background-color: var(--input-bg-color);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; flex-shrink: 0;
        }
        .header-main .logo-icon svg { width: 24px; height: 24px; }
        .header-text-container { text-align: center; }
        .header-title { font-size: 20px; font-weight: 800; color: var(--text-color); }
        .header-subtitle { font-size: 14px; color: var(--subtext-color); }
       
        .header-sub { 
            padding: 15px; display: flex; align-items: center; justify-content: space-between; 
            border-bottom: 1px solid var(--border-color);
        }
        .header-sub h2 { font-size: 20px; font-weight: 700; text-align: center; flex-grow: 1; margin: 0 10px; }
        .header-actions { display: flex; gap: 10px; flex-shrink: 0; }

        .content { padding: 0 20px 20px; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        
        .main-card {
            background-color: var(--card-bg-color); border-radius: 16px;
            border: 1px solid var(--border-color); padding: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        
        .input-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        .icon-btn {
            width: 48px; height: 48px; background-color: var(--input-bg-color);
            border: 1px solid var(--border-color); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
        }
        .icon-btn:hover { background-color: #3a3a3a; border-color: #555; transform: translateY(-2px); }
        .icon-btn svg { width: 24px; height: 24px; stroke: var(--subtext-color); }

        .icon-btn.primary {
            background: linear-gradient(145deg, #ff4d43, #e6342a);
            border-color: transparent;
        }
        .icon-btn.primary svg { stroke: var(--text-color); }
        .icon-btn.primary:hover { background: linear-gradient(145deg, #ff5c52, #fa4238); }
        
        .hidden-input { display: none; }

        #script-input {
            width: 100%; height: 25vh; background-color: var(--input-bg-color); color: var(--text-color);
            border: 1px solid var(--border-color); border-radius: 12px; padding: 15px;
            font-size: 15px; resize: none; font-family: var(--font-family);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #script-input:focus { outline: none; border-color: var(--primary-red); box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.3); }
        
        .analysis-options { border-top: 1px solid var(--border-color); margin-top: 20px; padding-top: 20px; }
        .option-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .option-item:last-child { margin-bottom: 0; }
        .option-label { font-size: 15px; font-weight: 500; color: var(--subtext-color); }

        .toggle-switch { display: flex; border-radius: 10px; overflow: hidden; background-color: var(--input-bg-color); width: 140px; }
        .toggle-switch input { display: none; }
        .toggle-switch label { flex: 1; text-align: center; padding: 8px 0; cursor: pointer; transition: background-color 0.3s, color 0.3s; margin: 0; font-size: 14px; font-weight: 500; }
        .toggle-switch input:checked + label { background-color: var(--primary-red); color: var(--text-color); font-weight: 700; }

        #character-select { width: 160px; padding: 8px 12px; background-color: var(--input-bg-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 10px; font-size: 14px; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10L12 15L17 10' stroke='%23A0A0A0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; padding-right: 30px; }

        #loading-screen { justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .waveform { display: flex; justify-content: center; align-items: center; height: 60px; margin-bottom: 30px; }
        .waveform .bar { width: 8px; height: 10px; background-color: #FFF; margin: 0 4px; border-radius: 4px; animation: wave 1.2s infinite ease-in-out; }
        .waveform .bar:nth-child(2) { animation-delay: 0.1s; background-color: var(--primary-yellow); }
        .waveform .bar:nth-child(3) { animation-delay: 0.2s; }
        .waveform .bar:nth-child(4) { animation-delay: 0.3s; background-color: var(--primary-yellow);}
        .waveform .bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes wave { 0%, 100% { transform: scaleY(0.5); opacity: 0.6; } 50% { transform: scaleY(3.5); opacity: 1; } }
        .loading-text { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .loading-tip { font-size: 15px; color: var(--subtext-color); }

        .report-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin: 0 20px; }
        .tab-link { flex: 1; padding: 15px 0; background: none; border: none; color: var(--subtext-color); font-size: 15px; cursor: pointer; transition: color 0.3s, border-bottom-color 0.3s; border-bottom: 3px solid transparent; font-weight: 600; }
        .tab-link.active { color: var(--primary-yellow); border-bottom-color: var(--primary-yellow); }
        
        .tab-content { display: none; padding-top: 30px; }
        .tab-content.active { display: block; }
        
        .report-section-title { font-size: 20px; font-weight: 700; color: var(--text-color); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .report-section-title svg { width: 24px; height: 24px; fill: var(--subtext-color); }

        .analysis-card { background-color: var(--card-bg-color); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .analysis-card h4 { font-size: 16px; color: var(--primary-yellow); margin-bottom: 12px; font-weight: 700; }
        .analysis-card p { font-size: 15px; margin-bottom: 15px; line-height: 1.7; color: #E0E0E0; }
        .analysis-card strong { color: var(--subtext-color); font-weight: 600; }

        .mood-keywords .keyword { display: inline-block; background-color: var(--input-bg-color); padding: 6px 14px; border-radius: 50px; margin-right: 8px; margin-bottom: 8px; font-size: 14px; font-weight: 500; }
        .color-palette { display: flex; margin-top: 15px; }
        .color-chip { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; border: 2px solid var(--bg-color); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .highlight-text { background-color: rgba(255, 214, 10, 0.1); padding: 20px; border-left: 4px solid var(--primary-yellow); font-weight: 500; border-radius: 0 8px 8px 0; }
        
        .emotion-graph-container { padding: 20px; background-color: #161616; border-radius: 8px; margin-top: 15px; border: 1px solid var(--border-color); }
        .emotion-graph { width: 100%; height: 150px; }
        .emotion-table { margin-top: 20px; width: 100%; border-collapse: collapse; }
        .emotion-table th, .emotion-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .emotion-table th { font-weight: 600; color: var(--subtext-color); }
        .emotion-table .point-number { text-align: center; font-weight: 700; color: var(--primary-yellow); }


        .line-coaching-item { border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; background: linear-gradient(145deg, #222, #1a1a1a); }
        .line-text { font-size: 17px; font-weight: 600; color: #fff; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed var(--border-color); font-style: italic; }
        .coaching-details p { font-size: 14px; margin-bottom: 10px; }
        .coaching-details strong { color: var(--subtext-color); display: inline-block; min-width: 80px; }

        .power-balance { margin-top: 20px; }
        .balance-bar-container { display: flex; align-items: center; margin-bottom: 15px; }
        .balance-label { font-size: 14px; width: 80px; color: var(--subtext-color); }
        .balance-bar { flex-grow: 1; height: 12px; background-color: var(--input-bg-color); border-radius: 6px; overflow: hidden; }
        .balance-fill { height: 100%; background: linear-gradient(90deg, #e6c300, #ffd60a); transition: width 0.8s cubic-bezier(0.25, 1, 0.5, 1); }
        
        .notification-toast {
            background-color: var(--primary-red); color: var(--text-color); padding: 12px 20px;
            border-radius: 10px; font-weight: 600; box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .notification-toast.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header-main">
            <div class="header-card">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-12h4v2h-4v-2zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z" fill="#fff"/></svg>
                </div>
                <div class="header-text-container">
                     <h1 class="header-title">AcTi ëŒ€ë³¸ë¶„ì„</h1>
                     <p class="header-subtitle">ì¤€ë¹„ëœ ë°°ìš°ë¥¼ ìœ„í•œ A-Class ì—°ê¸° ì½”ì¹­</p>
                </div>
            </div>
        </header>
        <main class="screen-wrapper">
            <section id="main-screen" class="screen active">
                <div class="content">
                    <div class="main-card">
                        <div class="input-actions">
                            <label for="file-input" class="icon-btn primary" title="ë¬¸ì„œ íŒŒì¼ ì²¨ë¶€">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                            </label>
                            <label for="gallery-input" class="icon-btn primary" title="ê°¤ëŸ¬ë¦¬ì—ì„œ ì‚¬ì§„ ì„ íƒ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            </label>
                            <label for="camera-input" class="icon-btn primary" title="ì¹´ë©”ë¼ë¡œ ì§ì ‘ ì´¬ì˜">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                            </label>
                            <button class="icon-btn primary" id="clear-btn" title="ë‚´ìš© ì§€ìš°ê¸°">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                            </button>
                             <input type="file" id="file-input" class="hidden-input" accept=".txt,.srt,.pdf">
                             <input type="file" id="gallery-input" class="hidden-input" accept="image/*">
                             <input type="file" id="camera-input" class="hidden-input" accept="image/*" capture="environment">
                        </div>
                        <textarea id="script-input" placeholder="ì´ê³³ì— ëŒ€ë³¸ì„ ë¶™ì—¬ë„£ê±°ë‚˜, ì•„ì´ì½˜ì„ ëˆŒëŸ¬ íŒŒì¼ì„ ì²¨ë¶€í•˜ì„¸ìš”."></textarea>
                        
                        <div class="analysis-options">
                            <div class="option-item">
                                <span class="option-label">ëŒ€ë³¸ í˜•ì‹</span>
                                 <div class="toggle-switch">
                                    <input type="radio" id="type-monologue" name="script-type" value="monologue">
                                    <label for="type-monologue">ë…ë°±</label>
                                    <input type="radio" id="type-scene" name="script-type" value="scene" checked>
                                    <label for="type-scene">ì¥ë©´</label>
                                </div>
                            </div>
                            <div class="option-item">
                                 <span class="option-label">ë¶„ì„í•  ìºë¦­í„°</span>
                                <select id="character-select" disabled>
                                    <option value="">ëŒ€ë³¸ ì…ë ¥ í›„ ì„ íƒ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                     <button id="analyze-btn" class="btn btn-primary" disabled>AcTi ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
                </div>
            </section>

            <section id="loading-screen" class="screen">
                <div class="waveform">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
                <p class="loading-text">AcTi ì—°ê¸° ë¶„ì„ ì—”ì§„ ê°€ë™ ì¤‘...</p>
                <p class="loading-tip" id="loadingTip"></p>
            </section>

            <section id="report-screen" class="screen">
                <header class="header-sub">
                    <button id="back-to-main-report" class="btn-back" title="ìƒˆ ë¶„ì„ ì‹œì‘">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                    <h2 id="report-title">AcTi ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                    <div class="header-actions">
                        <button id="save-jpg-btn" class="icon-btn" title="JPGë¡œ ì €ì¥">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        </button>
                        <button id="save-pdf-btn" class="icon-btn" title="PDFë¡œ ì €ì¥">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        </button>
                    </div>
                </header>

                <div class="report-tabs">
                    <button class="tab-link active" data-tab="overview">ì „ì²´ ì¡°ë§</button>
                    <button class="tab-link" data-tab="character">ìºë¦­í„°</button>
                    <button class="tab-link" data-tab="lines">ëŒ€ì‚¬ ì½”ì¹­</button>
                    <button class="tab-link" data-tab="relation">ê´€ê³„ ë¶„ì„</button>
                </div>

                <div class="content report-content" id="report-content-to-capture">
                    <div id="overview" class="tab-content active">
                        <h3 class="report-section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                            ì¥ë©´ ì „ì²´ ì¡°ë§ & ì¸ì‚¬ì´íŠ¸
                        </h3>
                        <div class="analysis-card">
                            <h4>ë¶„ìœ„ê¸° ë° í†¤ì•¤ë§¤ë„ˆ</h4>
                            <div class="mood-keywords" id="report-atmosphere-keywords"></div>
                            <div class="color-palette" id="report-color-palette"></div>
                        </div>
                        <div class="analysis-card">
                            <h4>ì¥ë©´ì˜ ëª©í‘œì™€ ê¸°ëŠ¥</h4>
                            <p id="report-scene-function"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>í•µì‹¬ ê°ˆë“± êµ¬ì¡° ìš”ì•½</h4>
                            <p class="highlight-text" id="report-conflict-summary"></p>
                        </div>
                    </div>
                    <div id="character" class="tab-content">
                        <h3 class="report-section-title">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                            ìºë¦­í„° ì‹¬ì¸µ í”„ë¡œíŒŒì¼ë§: <span id="report-character-name"></span>
                        </h3>
                        <div class="analysis-card">
                            <h4>ëª©í‘œì™€ ì¥ì• ë¬¼</h4>
                            <p><strong>ê¶ê·¹ì  ëª©í‘œ (Objective):</strong></p>
                            <p id="report-objective"></p>
                            <p><strong>ì¥ì• ë¬¼ (Obstacle):</strong></p>
                            <p id="report-obstacle"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>ì‹¬ë¦¬ ë¶„ì„</h4>
                            <p><strong>ì„œë¸Œí…ìŠ¤íŠ¸ (Subtext):</strong></p>
                            <p id="report-subtext"></p>
                            <p><strong>ì£¼ìš” í–‰ë™ ë™ì‚¬ (Action Verbs):</strong></p>
                            <p id="report-action-verbs"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>ê°ì •ì˜ ì—¬ì • (Emotional Journey)</h4>
                            <p>ê·¸ë˜í”„ì˜ ë²ˆí˜¸ì™€ ì•„ë˜ í‘œë¥¼ í•¨ê»˜ í™•ì¸í•˜ë©° ê°ì •ì˜ íë¦„ì„ íŒŒì•…í•˜ì„¸ìš”.</p>
                            <div class="emotion-graph-container">
                                <svg class="emotion-graph" id="reportEmotionGraph" viewBox="0 0 100 50" preserveAspectRatio="xMinYMid meet"></svg>
                            </div>
                            <div id="emotion-table-container"></div>
                        </div>
                    </div>
                    <div id="lines" class="tab-content">
                        <h3 class="report-section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                            í•µì‹¬ ëŒ€ì‚¬ ì§‘ì¤‘ ì½”ì¹­ (Killing Line)
                        </h3>
                        <div id="report-key-lines"></div>
                    </div>
                    <div id="relation" class="tab-content">
                        <h3 class="report-section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                            ì¸ë¬¼ ê´€ê³„ ë° ì—­í•™ ë¶„ì„
                        </h3>
                        <div class="analysis-card">
                            <h4>ê´€ê³„ ì •ì˜</h4>
                            <p id="report-relationship"></p>
                        </div>
                        <div class="analysis-card">
                            <h4>í˜ì˜ ê· í˜• (Power Balance)</h4>
                            <p id="report-power-dynamics"></p>
                            <div class="power-balance">
                                <div class="balance-bar-container">
                                    <div class="balance-label">ì‹œì‘ ì‹œì </div>
                                    <div class="balance-bar"><div class="balance-fill" id="balance-start"></div></div>
                                </div>
                                <div class="balance-bar-container">
                                    <div class="balance-label">ì¢…ë£Œ ì‹œì </div>
                                    <div class="balance-bar"><div class="balance-fill" id="balance-end"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <div id="notification-container" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: 10px;"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const { jsPDF } = window.jspdf;
        const mainScreen = document.getElementById('main-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const reportScreen = document.getElementById('report-screen');
        const analyzeBtn = document.getElementById('analyze-btn');
        const scriptInput = document.getElementById('script-input');
        const characterSelect = document.getElementById('character-select');
        const fileInput = document.getElementById('file-input');
        const galleryInput = document.getElementById('gallery-input');
        const cameraInput = document.getElementById('camera-input');
        const clearBtn = document.getElementById('clear-btn');
        const saveJpgBtn = document.getElementById('save-jpg-btn');
        const savePdfBtn = document.getElementById('save-pdf-btn');
        const appContainer = document.querySelector('.app-container');

        if (window.pdfjsLib) {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
        }

        function showScreen(screenElement) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            screenElement.classList.add('active');
            
            if (screenElement.id === 'loading-screen') {
                appContainer.classList.add('loading-active');
            } else {
                appContainer.classList.remove('loading-active');
            }
            window.scrollTo(0, 0);
        }

        document.getElementById('back-to-main-report').addEventListener('click', () => showScreen(mainScreen));
        
        document.querySelectorAll('.tab-link').forEach(button => {
            button.addEventListener('click', (e) => {
                const tabId = e.currentTarget.getAttribute('data-tab');
                document.querySelectorAll('.tab-link').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                e.currentTarget.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        function showNotification(message, duration = 3000) {
            const container = document.getElementById('notification-container');
            const notif = document.createElement('div');
            notif.className = 'notification-toast';
            notif.textContent = message;
            container.appendChild(notif);
            setTimeout(() => { notif.classList.add('show'); }, 10);
            setTimeout(() => {
                notif.classList.remove('show');
                notif.addEventListener('transitionend', () => notif.remove());
            }, duration);
        }
        
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const debouncedCharacterExtraction = debounce(async (script) => {
            if (script.length > 30) {
                await extractCharactersWithAI(script);
            } else {
                resetCharacterSelect();
            }
        }, 1000);

        scriptInput.addEventListener('input', (e) => {
            const script = e.target.value.trim();
            analyzeBtn.disabled = script.length === 0;
            debouncedCharacterExtraction(script);
        });
        
        clearBtn.addEventListener('click', () => {
            scriptInput.value = '';
            scriptInput.dispatchEvent(new Event('input', { bubbles: true }));
            resetCharacterSelect();
        });


        async function extractCharactersWithAI(script) {
            characterSelect.innerHTML = `<option value="">AcTië¡œ ìºë¦­í„° ì¶”ì¶œ ì¤‘...</option>`;
            characterSelect.disabled = true;

            const apiKey = "AIzaSyBbEsfDqt5ojPAJoo70Nozro4LacKk__4k";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const systemPrompt = `You are an expert script analyzer. Your only task is to extract character names who are speaking from a script. Be extremely precise.
- A character name is ALWAYS followed by their dialogue, either on the same line after a colon (e.g., "NAME: ...") or on the next line.
- Character names are short. Ignore long sentences.
- Ignore text in parentheses.
- Return a JSON object with a single key "characters" containing an array of the unique names.`;
            const userQuery = `Analyze the following script and return a JSON object of unique character names.\n\nScript:\n---\n${script}\n---`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: { type: "OBJECT", properties: { characters: { type: "ARRAY", items: { "type": "STRING" } } } }
                }
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const data = JSON.parse(jsonText);
                if (data.characters && data.characters.length > 0) populateCharacterSelect(data.characters);
                else resetCharacterSelect("ì¶”ì¶œëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            } catch (error) {
                console.error("ìºë¦­í„° ì¶”ì¶œ AI ì˜¤ë¥˜:", error);
                resetCharacterSelect("ì˜¤ë¥˜: ìºë¦­í„° ì¶”ì¶œ ì‹¤íŒ¨");
            }
        }

        function populateCharacterSelect(characters) {
            const currentVal = characterSelect.value;
            characterSelect.innerHTML = '<option value="">ë¶„ì„í•  ìºë¦­í„° ì„ íƒ</option>';
            characters.forEach(char => {
                const option = document.createElement('option');
                option.value = char; option.textContent = char;
                characterSelect.appendChild(option);
            });
            if(characters.includes(currentVal)) characterSelect.value = currentVal;
            characterSelect.disabled = false;
        }

        function resetCharacterSelect(message = "ëŒ€ë³¸ ì…ë ¥ í›„ ì„ íƒ") {
            characterSelect.innerHTML = `<option value="">${message}</option>`;
            characterSelect.disabled = true;
        }

        fileInput.addEventListener('change', async (event) => {
            await handleFile(event.target.files[0], 'document');
            event.target.value = '';
        });

        galleryInput.addEventListener('change', async (event) => {
            await handleFile(event.target.files[0], 'image');
            event.target.value = '';
        });
        
        cameraInput.addEventListener('change', async (event) => {
            await handleFile(event.target.files[0], 'image');
            event.target.value = '';
        });
        
        async function handleFile(file, type) {
            if (!file) return;
            analyzeBtn.disabled = true;
            showNotification(`${file.name} ì²˜ë¦¬ ì¤‘...`, 2000);
            
            try {
                let content = '';
                if (type === 'image') {
                    content = await extractTextFromImage(file);
                } else {
                     const extension = file.name.split('.').pop().toLowerCase();
                     if (extension === 'txt') content = await readFileAsText(file);
                     else if (extension === 'srt') content = parseSrtContent(await readFileAsText(file));
                     else if (extension === 'pdf') content = await readPdfContent(file);
                     else { showNotification('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.', 3000); return; }
                }
                
                if (scriptInput.value.trim().length > 0) {
                    scriptInput.value += '\n\n' + content;
                    showNotification('ëŒ€ë³¸ í˜ì´ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 2000);
                } else {
                    scriptInput.value = content;
                    showNotification('ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 2000);
                }

                scriptInput.dispatchEvent(new Event('input', { bubbles: true }));
                
            } catch(error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                showNotification('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 3000);
            } finally {
                analyzeBtn.disabled = scriptInput.value.trim().length === 0;
            }
        }

        async function extractTextFromImage(file) {
            showNotification('ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì¤‘...', 4000);
            const base64Data = await readFileAsBase64(file);
            
            const apiKey = "AIzaSyBbEsfDqt5ojPAJoo70Nozro4LacKk__4k";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const systemPrompt = `You are an expert Optical Character Recognition (OCR) AI. Your task is to extract all text from an image of a script. It is absolutely critical that you preserve the original line breaks and formatting perfectly. This is an acting script, so the line breaks between character names, dialogue, and parentheticals are extremely important for later analysis.
            **Bad Example (Incorrect formatting):**
            ìˆ˜ì• : ê·¸ë ‡ì£  ë„ë‘‘: ë„ˆ ë‚˜ì¤‘ì— ë§‰ ì‹ ê³  í•˜ê³  ê·¸ëŸ¬ë©´ ì•ˆë¼ ë‚˜ë„ ì‚¬ì •ì´ ìˆì–´ì„œ ê·¸ë˜ ë§ í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ (ì´ë•Œ ë’¤ì—ì„œ ë¬´ê¸°ë¥¼ ë“¤ê³  ë‚˜íƒ€ë‚˜ëŠ” ì€ìœ )
            **Good Example (Correct formatting):**
            ìˆ˜ì• : ê·¸ë ‡ì£ 
            ë„ë‘‘: ë„ˆ ë‚˜ì¤‘ì— ë§‰ ì‹ ê³  í•˜ê³  ê·¸ëŸ¬ë©´ ì•ˆë¼
            ë‚˜ë„ ì‚¬ì •ì´ ìˆì–´ì„œ ê·¸ë˜ ë§ í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ
            (ì´ë•Œ ë’¤ì—ì„œ ë¬´ê¸°ë¥¼ ë“¤ê³  ë‚˜íƒ€ë‚˜ëŠ” ì€ìœ )
            You must output the text exactly as it appears in the image, maintaining all original line breaks.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: "Extract all text from this image. It is an acting script, so you must preserve the original line breaks and formatting exactly as they appear." },
                        { inline_data: { mime_type: file.type, data: base64Data } }
                    ]
                }]
            };

            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`ì´ë¯¸ì§€ ë¶„ì„ API ì˜¤ë¥˜: ${response.status}`);
            
            const result = await response.json();
            return result.candidates[0].content.parts[0].text;
        }

        const readFileAsBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });

        const readFileAsText = file => new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = () => resolve(reader.result); reader.onerror = () => reject(reader.error); reader.readAsText(file, 'UTF-8'); });
        
        const parseSrtContent = srtText => srtText.split(/\r?\n/).filter(line => !/^\d*$/.test(line) && !line.includes('-->')).map(line => line.replace(/<[^>]*>/g, '')).join('\n');

        const readPdfContent = file => new Promise((resolve, reject) => {
            if (!window.pdfjsLib) return reject(new Error('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'));
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const pdf = await pdfjsLib.getDocument(new Uint8Array(e.target.result)).promise;
                    let fullText = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const items = textContent.items.sort((a, b) => Math.abs(a.transform[5] - b.transform[5]) < 5 ? a.transform[4] - b.transform[4] : b.transform[5] - a.transform[5]);
                        let lastY = -1; let lineText = '';
                        for(const item of items) {
                            if (lastY !== -1 && Math.abs(item.transform[5] - lastY) > 5) { fullText += lineText + '\n'; lineText = ''; }
                            lineText += item.str; lastY = item.transform[5];
                        };
                        fullText += lineText + '\n';
                    }
                    resolve(fullText.trim());
                } catch (error) { reject(error); }
            };
            reader.onerror = () => reject(reader.error);
            reader.readAsArrayBuffer(file);
        });

        analyzeBtn.addEventListener('click', () => {
            const script = scriptInput.value.trim();
            const scriptType = document.querySelector('input[name="script-type"]:checked').value;
            let selectedCharacter = characterSelect.value;
            if (scriptType === 'scene' && !selectedCharacter && characterSelect.options.length > 1) { showNotification("ë¶„ì„í•  ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
            if (!selectedCharacter) selectedCharacter = "ì£¼ì¸ê³µ";
            if (script) startAIAnalysis(script, scriptType, selectedCharacter);
        });

        let tipInterval;
        async function startAIAnalysis(script, type, character) {
            showScreen(loadingScreen);
            showLoadingTips();
            
            const apiKey = "AIzaSyBbEsfDqt5ojPAJoo70Nozro4LacKk__4k"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const systemPrompt = `You are 'AcTi', a world-class acting coach AI. Analyze the script deeply and provide your insights in the specified JSON format.
- Use acting terminology correctly (objective, obstacle, subtext, action verbs).
- 'colors' must be 3 hex codes for the scene's mood.
- 'emotionalJourney' maps the character's emotional progression (time: 0-100%, intensity: 0-100%). For each point, include the dialogue line that represents it.
- For 'keyLines', select ALL genuinely critical lines for the performance, not a fixed number.
- 'balanceStart' and 'balanceEnd' are numbers from 0-100 representing the character's power level.
- ALL text output MUST be in Korean. The 'title' should be based on the script content, or 'AcTi ëŒ€ë³¸ ë¶„ì„' if not obvious. 'opponent' should be identified, otherwise use 'ìƒëŒ€ë°©'.`;
            const userQuery = `Analyze this script:\n---\n${script}\n---\nContext:\n- Type: ${type}\n- Character: ${character}\nProvide a complete analysis.`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {type: 'OBJECT', properties: {title: { type: 'STRING' }, character: { type: 'STRING' }, opponent: { type: 'STRING' }, type: { type: 'STRING' }, sceneOverview: {type: 'OBJECT', properties: {atmosphereKeywords: { type: 'ARRAY', items: { type: 'STRING' } }, colors: { type: 'ARRAY', items: { type: 'STRING' } }, sceneFunction: { type: 'STRING' }, conflictSummary: { type: 'STRING' }}}, characterProfile: {type: 'OBJECT', properties: {objective: { type: 'STRING' }, obstacle: { type: 'STRING' }, subtext: { type: 'STRING' }, actionVerbs: { type: 'ARRAY', items: { type: 'STRING' } }, emotionalJourney: {type: 'ARRAY', items: {type: 'OBJECT', properties: {time: { type: 'NUMBER' }, emotion: { type: 'STRING' }, intensity: { type: 'NUMBER' }, line: { type: 'STRING' }}}}}}, keyLines: {type: 'ARRAY', items: {type: 'OBJECT', properties: {line: { type: 'STRING' }, intention: { type: 'STRING' }, tempo: { type: 'STRING' }, pause: { type: 'STRING' }, tone: { type: 'STRING' }}}}, relationshipDynamics: {type: 'OBJECT', properties: {relationship: { type: 'STRING' }, powerDynamics: { type: 'STRING' }, balanceStart: { type: 'NUMBER' }, balanceEnd: { type: 'NUMBER' }}}}}
                }
            };
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
                const result = await response.json();
                const analysisReport = JSON.parse(result.candidates[0].content.parts[0].text);
                displayReport(analysisReport);
                showScreen(reportScreen);
            } catch (error) {
                console.error("AcTi ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                showNotification("AcTi ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", 4000);
                showScreen(mainScreen);
            } finally { clearInterval(tipInterval); }
        }

        function showLoadingTips() {
            const tips = ["ì¸ë¬¼ì˜ ëª©í‘œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", "ìƒëŒ€ë°©ì˜ ë§ì„ ê²½ì²­í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì—°ê¸°ì˜ ì‹œì‘ì…ë‹ˆë‹¤.", "í˜¸í¡ì„ ì¡°ì ˆí•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ê°ì •ì˜ ê¹Šì´ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.", "ëŒ€ì‚¬ ì´ë©´ì˜ 'ì„œë¸Œí…ìŠ¤íŠ¸'ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.", "í–‰ë™ ë™ì‚¬(Action Verb)ë¥¼ ìƒê°í•˜ë©° ëŒ€ì‚¬ë¥¼ í•´ë³´ì„¸ìš”."];
            let index = 0; const tipElement = document.getElementById('loadingTip');
            tipElement.innerHTML = `ğŸ’¡ <span>"${tips[index]}"</span>`;
            tipInterval = setInterval(() => {
                index = (index + 1) % tips.length;
                tipElement.innerHTML = `ğŸ’¡ <span>"${tips[index]}"</span>`;
            }, 2500);
        }
        
        async function captureReport(format = 'jpeg') {
            const fileExtension = format === 'jpeg' ? 'jpg' : 'pdf';
            const notificationMessage = fileExtension.toUpperCase() + 'ë¡œ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
            showNotification(notificationMessage, 2000);
            
            const reportContent = document.getElementById('report-content-to-capture');
            const allTabs = reportContent.querySelectorAll('.tab-content');
            allTabs.forEach(tab => tab.style.display = 'block');

            try {
                const canvas = await html2canvas(reportContent, {
                    scale: 2,
                    backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-color')
                });

                const reportTitle = (document.getElementById('report-title').textContent || 'AcTi_Report').replace(/\s+/g, '_');

                if (format === 'jpeg') {
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.download = `${reportTitle}.jpg`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else { // PDF
                    const { jsPDF } = window.jspdf;
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 210; 
                    const pageHeight = 297; 
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft > 0) {
                      position = -heightLeft;
                      pdf.addPage();
                      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                      heightLeft -= pageHeight;
                    }
                    pdf.save(`${reportTitle}.pdf`);
                }
                
                showNotification(fileExtension.toUpperCase() + ' ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 3000);

            } catch (error) {
                console.error(`ë¦¬í¬íŠ¸ ${format} ì €ì¥ ì˜¤ë¥˜:`, error);
                showNotification(`${format.toUpperCase()} ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`, 3000);
            } finally {
                 allTabs.forEach(tab => {
                    if(!tab.classList.contains('active')) {
                        tab.style.display = 'none';
                    }
                 });
            }
        }
        
        saveJpgBtn.addEventListener('click', () => captureReport('jpeg'));
        savePdfBtn.addEventListener('click', () => captureReport('pdf'));


        function displayReport(report) {
            document.getElementById('report-title').textContent = report.title || "AcTi ë¶„ì„ ë¦¬í¬íŠ¸";
            document.getElementById('report-character-name').textContent = report.character;
            document.getElementById('report-atmosphere-keywords').innerHTML = (report.sceneOverview.atmosphereKeywords || []).map(k => `<span class="keyword">#${k}</span>`).join('');
            document.getElementById('report-color-palette').innerHTML = (report.sceneOverview.colors || []).map(color => `<div class="color-chip" style="background-color: ${color};"></div>`).join('');
            document.getElementById('report-scene-function').textContent = report.sceneOverview.sceneFunction;
            document.getElementById('report-conflict-summary').textContent = report.sceneOverview.conflictSummary;
            document.getElementById('report-objective').textContent = report.characterProfile.objective;
            document.getElementById('report-obstacle').textContent = report.characterProfile.obstacle;
            document.getElementById('report-subtext').textContent = report.characterProfile.subtext;
            document.getElementById('report-action-verbs').textContent = (report.characterProfile.actionVerbs || []).join(', ');
            drawEmotionGraph(report.characterProfile.emotionalJourney);
            const keyLinesEl = document.getElementById('report-key-lines');
            keyLinesEl.innerHTML = '';
            (report.keyLines || []).forEach(item => {
                const lineItem = document.createElement('div');
                lineItem.className = 'line-coaching-item';
                lineItem.innerHTML = `<p class="line-text">"${item.line}"</p><div class="coaching-details"><p><strong>ì˜ë„:</strong> ${item.intention}</p><p><strong>ì–´ì¡°:</strong> ${item.tone}</p><p><strong>í…œí¬:</strong> ${item.tempo}</p><p><strong>í˜¸í¡/ë©ˆì¶¤:</strong> ${item.pause}</p></div>`;
                keyLinesEl.appendChild(lineItem);
            });
            document.getElementById('report-relationship').textContent = report.relationshipDynamics.relationship;
            document.getElementById('report-power-dynamics').textContent = report.relationshipDynamics.powerDynamics;
            const { balanceStart, balanceEnd } = report.relationshipDynamics;
            const startEl = document.getElementById('balance-start');
            const endEl = document.getElementById('balance-end');
            startEl.style.width = '0%'; endEl.style.width = '0%';
            setTimeout(() => {
                startEl.style.width = `${balanceStart}%`;
                endEl.style.width = `${balanceEnd}%`;
            }, 100);
        }

        function drawEmotionGraph(data) {
            const svg = document.getElementById('reportEmotionGraph'); 
            const tableContainer = document.getElementById('emotion-table-container');
            if (!svg || !tableContainer) return;

            svg.innerHTML = ''; 
            tableContainer.innerHTML = '';
            
            const axisColor = '#555';
            svg.innerHTML += `<line x1="0" y1="50" x2="100" y2="50" stroke="${axisColor}" stroke-width="0.3"/><line x1="0" y1="0" x2="0" y2="50" stroke="${axisColor}" stroke-width="0.3"/>`;
            
            let pathD = "M";
            (data || []).forEach((point, index) => {
                const x = point.time; 
                const y = 50 - (point.intensity / 2);
                pathD += (index === 0 ? '' : ' L ') + `${x} ${y}`;
                
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", x);
                text.setAttribute("y", y - 3); 
                text.setAttribute("font-size", "4");
                text.setAttribute("fill", "var(--primary-yellow)");
                text.setAttribute("text-anchor", "middle");
                text.textContent = index + 1;
                svg.appendChild(text);

                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", x); circle.setAttribute("cy", y); circle.setAttribute("r", "2");
                circle.setAttribute("fill", "var(--primary-yellow)"); circle.setAttribute("stroke", "var(--bg-color)"); circle.setAttribute("stroke-width", "0.5");
                const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
                title.textContent = `${index+1}. ê°ì •: ${point.emotion} (ê°•ë„: ${point.intensity}%)\nëŒ€ì‚¬: "${point.line}"`;
                circle.appendChild(title);
                svg.appendChild(circle);
            });

            if(data && data.length > 0) {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", pathD); path.setAttribute("fill", "none");
                path.setAttribute("stroke", "rgba(255, 214, 10, 0.7)"); path.setAttribute("stroke-width", "1.5");
                svg.appendChild(path);

                const table = document.createElement('table');
                table.className = 'emotion-table';
                table.innerHTML = `<thead><tr><th style="width:10%">ë²ˆí˜¸</th><th>í•µì‹¬ ëŒ€ì‚¬</th><th>ê°ì • ë³€í™”</th></tr></thead>`;
                const tbody = document.createElement('tbody');
                data.forEach((point, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="point-number">${index + 1}</td><td>"${point.line}"</td><td>${point.emotion} (ê°•ë„ ${point.intensity}%)</td>`;
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                tableContainer.appendChild(table);
            }
        }
    });
</script>
</body>
</html>
