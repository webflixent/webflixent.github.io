<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AcTi 롤모델 - AI 배우 분석 리포트</title>
    <!-- 홈 화면 아이콘 설정 -->
    <link rel="apple-touch-icon" href="actiroll3.png">
    <link rel="icon" type="image/png" href="actiroll3.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #FDF8F0; /* Warm, elegant off-white */
            --text-primary: #4E443C; /* Dark, warm brown for headings */
            --text-secondary: #71665D; /* Slightly lighter for body text */
            --accent-color: #6B5B4B; /* Muted, sophisticated brown for buttons/accents */
            --border-color: #E5E0D9;
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-main); color: var(--text-secondary); }
        h1, h2, h3, h4, h5, .font-serif { font-family: 'Playfair Display', serif; color: var(--text-primary); }
        .accent-text { color: var(--accent-color); }
        .accent-bg { background-color: var(--accent-color); }
        
        #report-content ::-webkit-scrollbar, #qna-chatbox::-webkit-scrollbar { width: 8px; }
        #report-content ::-webkit-scrollbar-track, #qna-chatbox::-webkit-scrollbar-track { background: #EFEAE4; }
        #report-content ::-webkit-scrollbar-thumb, #qna-chatbox::-webkit-scrollbar-thumb { background-color: #D1C9BF; border-radius: 10px; }
        #report-content ::-webkit-scrollbar-thumb:hover, #qna-chatbox::-webkit-scrollbar-thumb:hover { background-color: #BDB2A7; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* AI가 생성한 콘텐츠 공통 스타일 */
        .ai-generated-content h2, .ai-generated-content h3 {
             font-family: 'Playfair Display', serif;
             color: var(--text-primary);
             margin-bottom: 0.75rem;
        }
        .ai-generated-content h2 { font-size: 1.75rem; margin-top: 2rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color); }
        .ai-generated-content h3 { font-size: 1.25rem; margin-top: 1.5rem; }
        .ai-generated-content p { line-height: 1.7; margin-bottom: 1rem; }
        .ai-generated-content ul { list-style-type: disc; list-style-position: outside; padding-left: 1.5rem; margin-bottom: 1rem; }
        .ai-generated-content li { margin-bottom: 0.5rem; padding-left: 0.5rem; }
        .ai-generated-content li::marker { color: var(--accent-color); }
        .ai-generated-content strong { color: var(--text-primary); font-weight: 500; }
        .ai-generated-content p:last-child { margin-bottom: 0; }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="p-6 md:p-8 border-b sticky top-0 bg-[var(--bg-main)] z-10" style="border-color: var(--border-color);">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="actiroll3.png" alt="AcTi Logo" class="h-10 w-10 rounded-full object-cover bg-stone-200 border border-stone-300">
                <h1 class="text-2xl md:text-3xl tracking-wider">AcTi 롤모델</h1>
            </div>
            <div class="flex items-center space-x-2 md:space-x-4">
                <button id="save-jpg-button" title="리포트 저장하기" class="accent-bg text-white rounded-full p-2.5 hover:opacity-90 transition-all disabled:opacity-40 disabled:cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                </button>
                <button id="qna-button" title="AcTi Q&A" class="accent-bg text-white rounded-full p-2.5 hover:opacity-90 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main id="main-content" class="container mx-auto p-6 md:p-12">
        <!-- STEP 1: Search Section -->
        <section id="search-section" class="text-center transition-opacity duration-700 fade-in-up">
            <h2 class="text-4xl md:text-6xl mb-4">The Actor's Dossier</h2>
            <p class="mb-10 max-w-2xl mx-auto">분석하고 싶은 배우의 이름을 입력하세요.<br>AcTi가 그의 모든 것을 분석하여, 당신을 위한 정밀 리포트를 생성합니다.</p>
            <div class="max-w-xl mx-auto flex items-center gap-2 p-2 bg-white rounded-full shadow-md border" style="border-color: var(--border-color);">
                <input type="text" id="actor-search-input" class="w-full py-3 px-5 bg-transparent text-lg focus:outline-none" placeholder="예: 이병헌, 전도연, 최민식" style="color: var(--text-primary);">
                <button id="search-button" class="accent-bg text-white rounded-full p-3 hover:opacity-90 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
            </div>
        </section>

        <!-- Loading Section -->
        <section id="loading-section" class="hidden text-center transition-opacity duration-500">
            <div class="flex flex-col items-center justify-center min-h-[50vh]">
                <div class="w-16 h-16 border-4 border-stone-200 rounded-full animate-spin" style="border-top-color: var(--accent-color);"></div>
                <h3 class="text-3xl mt-8">AcTi가 배우를 분석하고 있습니다...</h3>
                <p id="loading-status" class="mt-2">잠시만 기다려주세요.</p>
            </div>
        </section>

        <!-- ERROR Display Section -->
        <section id="error-section" class="hidden my-8 transition-opacity duration-500">
             <div class="max-w-2xl mx-auto bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold font-serif" id="error-title">분석 오류!</strong>
                <p id="error-message">오류가 발생했습니다.</p>
             </div>
        </section>

        <!-- STEP 2: Report Section -->
        <section id="report-section" class="hidden"></section>

    </main>

    <!-- AcTi Q&A Modal -->
    <div id="qna-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col" style="background-color: var(--bg-main);">
            <header class="p-4 border-b flex justify-between items-center" style="border-color: var(--border-color);">
                <h3 class="text-2xl font-serif">AcTi Q&A</h3>
                <button id="close-qna-modal" class="p-2 -mr-2 text-2xl leading-none text-stone-500 hover:text-stone-800">&times;</button>
            </header>
            <div id="qna-chatbox" class="flex-1 p-4 overflow-y-auto space-y-4">
                <div class="flex items-start gap-3">
                    <div class="accent-bg text-white text-sm rounded-full h-8 w-8 flex-shrink-0 flex items-center justify-center font-bold">A</div>
                    <div class="bg-white rounded-lg p-3 max-w-lg shadow-sm border ai-generated-content" style="border-color: var(--border-color);">
                        <p class="text-sm">안녕하세요! 배우 분석이나 연기에 대해 궁금한 점이 있다면 무엇이든 물어보세요.</p>
                    </div>
                </div>
            </div>
            <footer class="p-4 border-t bg-white" style="border-color: var(--border-color);">
                <form id="qna-form" class="flex items-center gap-2">
                    <input type="text" id="qna-input" class="w-full py-2 px-4 bg-gray-100 rounded-full focus:outline-none focus:ring-2 focus:ring-opacity-50" style="--tw-ring-color: var(--accent-color);" placeholder="AcTi에게 질문하기..." autocomplete="off">
                    <button type="submit" class="accent-bg text-white rounded-full p-3 hover:opacity-90 transition-opacity">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4Z"></path><path d="M22 2 11 13"></path></svg>
                    </button>
                </form>
            </footer>
        </div>
    </div>
    
    <script>
        // --- CONFIGURATION ---
        const API_KEY = "AIzaSyBbEsfDqt5ojPAJoo70Nozro4LacKk__4k";
        const GOOGLE_CX_ID = "a6991c88ccc1b45eb";

        // --- DOM ELEMENTS ---
        const searchSection = document.getElementById('search-section');
        const searchInput = document.getElementById('actor-search-input');
        const searchButton = document.getElementById('search-button');
        const loadingSection = document.getElementById('loading-section');
        const loadingStatus = document.getElementById('loading-status');
        const reportSection = document.getElementById('report-section');
        const errorSection = document.getElementById('error-section');
        const errorMessageEl = document.getElementById('error-message');
        const saveJpgButton = document.getElementById('save-jpg-button');
        const qnaButton = document.getElementById('qna-button');
        const qnaModal = document.getElementById('qna-modal');
        const closeQnaModalButton = document.getElementById('close-qna-modal');
        const qnaForm = document.getElementById('qna-form');
        const qnaInput = document.getElementById('qna-input');
        const qnaChatbox = document.getElementById('qna-chatbox');

        // Initial state
        saveJpgButton.disabled = true;

        /**
         * Fetches a resource with an exponential backoff retry mechanism.
         */
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status >= 500 && response.status < 600) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) {
                         console.error("Fetch failed after multiple retries:", error);
                         throw error;
                    }
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
        }

        // --- DYNAMIC AI REPORT GENERATION ---
        async function generateAIReport(actorName) {
            if (!API_KEY) {
                throw new Error("API 키가 설정되지 않았습니다.");
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            const systemPrompt = `당신은 '배우가 배우를 연구하는' 관점을 지닌 세계 최고의 연기 코치입니다. 당신의 임무는 단순한 정보 요약이 아니라, 배우 지망생이 주어진 배우를 '롤모델'로서 철저히 분석하고, 그의 연기 기술과 커리어 전략을 자신의 것으로 만들 수 있도록 돕는 것입니다. 최신 뉴스를 검색하는 것이 아니라, 그의 연기 본질과 성장 과정을 분석하여 '따라 배울 점'을 명확히 제시해야 합니다. 최종 결과물은 다른 설명 없이 오직 리포트 내용이 담긴 단일 HTML 문자열이어야 합니다. <h2>, <h3>, <p>, <ul>, <li>, <strong> 같은 태그를 사용하여 내용을 구조화하세요. 전체 응답은 이 HTML 문자열이어야 하며, 마크다운 형식(\`\`\`)으로 감싸지 마세요. 보고서 전체에서 'AI'라는 단어 대신 'AcTi'를 사용하세요. 리포트에는 반드시 다음의 관점이 포함되어야 합니다: 1. **롤모델로서의 핵심 가치**: 왜 이 배우를 롤모델로 삼아야 하는가? 그의 어떤 점이 다른 배우와 차별화되는가? 2. **'훔치고 싶은' 연기 기술**: 그의 대표적인 연기 테크닉(시선 처리, 목소리 톤, 감정의 완급 조절 등)을 구체적인 작품 장면을 예로 들어 분석하고, 어떻게 훈련해야 하는지 설명. 3. **현명한 커리어 설계**: 그의 필모그래피가 어떻게 그의 페르소나를 구축했는지, 그리고 작품 선택의 기준이 무엇인지 분석하여, 배우 지망생이 자신의 커리어를 어떻게 설계해야 할지에 대한 통찰을 제공. 4. **내면을 지배하는 연기 철학**: 그의 인터뷰나 행보를 통해 드러난 연기에 대한 태도와 마인드셋을 분석하고, 이것이 그의 연기에 어떻게 반영되는지 설명. 5. **나만의 것으로 만드는 Action Plan**: '이 배우처럼 되기 위해' 내일부터 당장 실천할 수 있는 구체적이고 단계적인 훈련 방법을 제시. (예: 특정 영화의 독백 100번 따라하기, 그의 인터뷰 영상 필사하기 등)`;
            const userQuery = `'${actorName}' 배우에 대한 롤모델 분석 리포트를 HTML 형식으로 생성해줘.`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            const response = await fetchWithRetry(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) {
                const errorBody = await response.json();
                console.error("AcTi API Error:", errorBody);
                throw new Error(`AcTi 리포트 생성에 실패했습니다. (Status: ${response.status}) - ${errorBody.error.message}`);
            }
            const result = await response.json();
            if (!result.candidates || !result.candidates[0].content.parts[0].text) {
                throw new Error("AcTi가 유효한 리포트를 생성하지 못했습니다.");
            }
            return result.candidates[0].content.parts[0].text;
        }

        async function fetchActorImage(actorName) {
            const placeholderUrl = `https://placehold.co/160x160/E5E0D9/4E443C?text=${encodeURIComponent(actorName)}`;
            if (!API_KEY || !GOOGLE_CX_ID) {
                console.warn("API 키 또는 CX ID가 없어 이미지 검색을 건너뜁니다.");
                return placeholderUrl;
            }

            const query = encodeURIComponent(`${actorName} 배우 공식 프로필`);
            const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${GOOGLE_CX_ID}&q=${query}&searchType=image&num=1&imgSize=large`;

            try {
                const searchResponse = await fetchWithRetry(url);
                const searchData = await searchResponse.json();
                if (!searchResponse.ok) { throw new Error(searchData.error.message); }

                if (searchData.items && searchData.items.length > 0) {
                    const imageUrl = searchData.items[0].link;
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(imageUrl)}`;

                    try {
                        const imageResponse = await fetch(proxyUrl);
                        if (!imageResponse.ok) {
                            console.warn(`Failed to fetch image from proxy for ${actorName}. Status: ${imageResponse.status}`);
                            return placeholderUrl;
                        }
                        const imageBlob = await imageResponse.blob();
                        if (!imageBlob.type.startsWith('image/')) {
                             console.warn(`Proxied content for ${actorName} is not an image. Type: ${imageBlob.type}`);
                             return placeholderUrl;
                        }
                        return URL.createObjectURL(imageBlob);
                    } catch (imageError) {
                        console.error(`Error fetching or creating blob for ${actorName}'s image:`, imageError);
                        return placeholderUrl;
                    }
                }
                return placeholderUrl;
            } catch (searchError) {
                console.error(`Error searching for image for ${actorName}:`, searchError);
                return placeholderUrl;
            }
        }

        async function generateReport(actorName) {
            searchSection.style.display = 'none';
            errorSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');
            saveJpgButton.disabled = true;

            const loadingMessages = ["실시간 정보 수집 중...", "AcTi가 데이터를 분석하고 있습니다...", "리포트 초안 작성 중...", "최종 리포트 생성 중..."];
            let msgIndex = 0;
            const interval = setInterval(() => {
                loadingStatus.textContent = loadingMessages[msgIndex++ % loadingMessages.length];
            }, 1500);

            try {
                const reportHtml = await generateAIReport(actorName);
                const imageUrl = await fetchActorImage(actorName);
                clearInterval(interval);
                loadingSection.classList.add('hidden');
                displayReport(actorName, imageUrl, reportHtml);
            } catch (error) {
                clearInterval(interval);
                loadingSection.classList.add('hidden');
                searchSection.style.display = 'block';
                errorMessageEl.textContent = `오류가 발생했습니다: ${error.message}.`;
                errorSection.classList.remove('hidden');
            }
        }
        
        function displayReport(actorName, imageUrl, reportHtml) {
            reportSection.innerHTML = `
                <div id="report-to-capture" class="bg-white rounded-lg shadow-xl p-8 md:p-12 border fade-in-up" style="border-color: var(--border-color);">
                    <button id="back-to-search" class="accent-bg text-white text-sm font-medium py-2 px-4 rounded-full mb-8 hover:opacity-90 transition-opacity">← 다른 배우 분석하기</button>
                    <header class="text-center mb-12">
                        <img src="${imageUrl}" alt="${actorName}" class="w-40 h-40 object-cover rounded-full mx-auto mb-4 shadow-lg border-4" style="border-color: var(--border-color);">
                        <h1 class="text-5xl mb-2 font-serif">${actorName}</h1>
                        <h2 class="text-2xl text-stone-500 font-serif tracking-widest mt-2">롤모델 분석 REPORT</h2>
                    </header>
                    <div id="report-content">
                        <div class="ai-generated-content">
                            ${reportHtml}
                        </div>
                    </div>
                </div>`;
            reportSection.classList.remove('hidden');
            saveJpgButton.disabled = false;
            
            document.getElementById('back-to-search').addEventListener('click', () => {
                reportSection.innerHTML = '';
                reportSection.classList.add('hidden');
                searchInput.value = '';
                searchSection.style.display = 'block';
                saveJpgButton.disabled = true;
            });
        }

        // --- SAVE REPORT AS JPG (STABLE VERSION) ---
        async function saveReportAsJpg() {
            const reportElement = document.getElementById('report-to-capture');
            if (!reportElement) return;

            showErrorModal('리포트 이미지 생성 중...', true);
            saveJpgButton.disabled = true;

            // --- KEY FIX: Temporarily remove animation class to prevent blank captures ---
            const wasAnimated = reportElement.classList.contains('fade-in-up');
            if (wasAnimated) {
                reportElement.classList.remove('fade-in-up');
            }

            // A short delay to allow the DOM to update after class removal.
            await new Promise(resolve => setTimeout(resolve, 100));
            window.scrollTo(0, 0);

            try {
                const canvas = await html2canvas(reportElement, {
                    scale: 2.5,
                    useCORS: true,
                    backgroundColor: '#FFFFFF',
                    logging: false
                });

                // This is the stable download method from the user's sample code.
                const link = document.createElement('a');
                const actorName = searchInput.value.trim().replace(/\s+/g, '_') || 'AcTi_Report';
                link.download = `AcTi_Report_${actorName}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                const generatingModal = document.getElementById('generating-indicator');
                if (generatingModal) document.body.removeChild(generatingModal);

                showErrorModal("다운로드가 시작되었습니다. 갤러리를 확인해주세요.");

            } catch (err) {
                console.error("JPG 저장 중 오류 발생:", err);
                const generatingModal = document.getElementById('generating-indicator');
                if (generatingModal) document.body.removeChild(generatingModal);
                showErrorModal("이미지 생성에 실패했습니다. 잠시 후 다시 시도해주세요.");
            } finally {
                // Restore the animation class if it was removed.
                if (wasAnimated) {
                    reportElement.classList.add('fade-in-up');
                }
                saveJpgButton.disabled = false;
            }
        }
        
        // --- Q&A MODAL ---
        async function getQnaResponse(question) {
             if (!API_KEY) {
                return "<p>죄송합니다. API 키가 설정되지 않아 답변을 생성할 수 없습니다.</p>";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            const systemPrompt = "당신은 'AcTi'라는 이름을 가진 연기 전문 코치입니다. 배우 지망생의 질문에 대해 핵심적인 내용만 간결하고 명확하게 답변하세요. 불필요한 인사말('안녕하세요', '질문해주셨군요' 등)이나 응원 문구('응원하겠습니다' 등)는 절대 사용하지 마세요. 당신의 이름은 'AcTi'이며, 'AI'라는 단어는 사용하지 마세요. 답변은 항상 한국어로, 전문가적인 조언을 담아야 합니다. 최종 결과물은 오직 답변 내용이 담긴 단일 HTML 문자열이어야 하며, <p>, <ul>, <li>, <strong> 태그를 사용하여 구조화하세요. 마크다운 형식(**)은 절대 사용하지 마세요.";
            const payload = {
                contents: [{ parts: [{ text: question }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            try {
                const response = await fetchWithRetry(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                return result.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("AcTi Q&A Error:", error);
                return "<p>죄송합니다. 답변을 생성하는 중에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.</p>";
            }
        }

        function appendMessage(sender, message) {
            const isUser = sender === 'user';
            const messageHtml = isUser ? `
                <div class="flex items-start gap-3 justify-end">
                    <div class="accent-bg text-white rounded-lg p-3 max-w-lg shadow-sm">
                        <p class="text-sm">${message.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</p>
                    </div>
                </div>` : 
                `<div class="flex items-start gap-3">
                    <div class="accent-bg text-white text-sm rounded-full h-8 w-8 flex-shrink-0 flex items-center justify-center font-bold">A</div>
                    <div class="bg-white rounded-lg p-3 max-w-lg shadow-sm border text-sm ai-generated-content" style="border-color: var(--border-color);">
                        ${message}
                    </div>
                </div>`;
            qnaChatbox.innerHTML += messageHtml;
            qnaChatbox.scrollTop = qnaChatbox.scrollHeight;
        }

        function showErrorModal(message, isIndicator = false) {
            // Remove any existing modals first
            const existingModal = document.querySelector('.alert-modal');
            if (existingModal) document.body.removeChild(existingModal);

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 alert-modal';
            if (isIndicator) modal.id = 'generating-indicator';

            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 shadow-lg text-center w-11/12 max-w-sm">
                    <h3 class="text-xl font-bold mb-4 font-serif">${isIndicator ? '안내' : '알림'}</h3>
                    <p>${message}</p>
                    ${!isIndicator ? '<button class="mt-6 accent-bg text-white py-2 px-6 rounded-full">확인</button>' : ''}
                </div>
            `;
            document.body.appendChild(modal);
            if (!isIndicator) {
                modal.querySelector('button').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
            }
        }

        // --- EVENT LISTENERS ---
        searchButton.addEventListener('click', () => {
            const actorName = searchInput.value.trim();
            if(actorName) generateReport(actorName);
        });

        searchInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                const actorName = searchInput.value.trim();
                if(actorName) generateReport(actorName);
            }
        });

        saveJpgButton.addEventListener('click', saveReportAsJpg);

        qnaButton.addEventListener('click', () => qnaModal.classList.remove('hidden'));
        closeQnaModalButton.addEventListener('click', () => qnaModal.classList.add('hidden'));

        qnaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = qnaInput.value.trim();
            if (!question) return;

            appendMessage('user', question);
            qnaInput.value = '';
            qnaInput.disabled = true;

            const thinkingMessage = `<div id="thinking" class="flex items-start gap-3"><div class="accent-bg text-white text-sm rounded-full h-8 w-8 flex-shrink-0 flex items-center justify-center font-bold">A</div><div class="bg-white rounded-lg p-3 max-w-lg shadow-sm border" style="border-color: var(--border-color);"><p class="text-sm text-stone-400 italic">AcTi가 생각 중...</p></div></div>`;
            qnaChatbox.innerHTML += thinkingMessage;
            qnaChatbox.scrollTop = qnaChatbox.scrollHeight;

            const response = await getQnaResponse(question);
            document.getElementById('thinking')?.remove();
            appendMessage('acti', response);
            qnaInput.disabled = false;
            qnaInput.focus();
        });

        window.addEventListener('DOMContentLoaded', () => {
            if (!API_KEY || !GOOGLE_CX_ID) {
                showErrorModal("API 키가 설정되지 않았습니다. 분석 기능이 작동하지 않을 수 있습니다. 스크립트에서 API_KEY와 GOOGLE_CX_ID 변수를 설정해주세요.");
            }
        });

    </script>
</body>
</html>

