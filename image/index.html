<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì›¹ ì´ë¯¸ì§€ ì»¨ì„¤í„´íŠ¸ (ë°°ìš°/ëª¨ë¸)</title>
  <meta name="color-scheme" content="light" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#ECE9E4;          /* ë°°ê²½(ìŠ¤í†¤ ë² ì´ì§€) */
      --paper:#F7F4F1;       /* ì¹´ë“œ ìƒë‹¨ ë¼ì´íŠ¸ */
      --card:#FFFFFF;        /* ì¹´ë“œ ë³¸ìƒ‰ */
      --ink:#3A352F;         /* ë³¸ë¬¸ ì»¬ëŸ¬ */
      --sub:#827A72;         /* ë³´ì¡° í…ìŠ¤íŠ¸ */
      --accent:#7B5E49;      /* í¬ì»¤ìŠ¤(ë¸Œë¡ ì¦ˆ) */
      --accent-2:#5E4738;    /* í¬ì»¤ìŠ¤ ë”¥ */
      --ring:#CDB9A9;        /* í¬ì»¤ìŠ¤ ë§ */
      --line:#E7E1DB;        /* ì„¹ì…˜ ê²½ê³„ì„  */
      --shadow-1: 0 14px 40px rgba(73,56,43,.16), 0 2px 10px rgba(73,56,43,.08);
      --inner: inset 0 1px 0 rgba(255,255,255,.8), inset 0 -1px 0 rgba(0,0,0,.04);
    }
    html, body { height: 100%; }
    body{ font-family:'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; color:var(--ink); background:
      radial-gradient(1200px 800px at 10% -10%, #ffffff 0%, rgba(255,255,255,.6) 45%, rgba(255,255,255,0) 60%),
      radial-gradient(800px 600px at 90% 0%, #fff 0%, rgba(255,255,255,.5) 40%, rgba(255,255,255,0) 60%),
      linear-gradient(180deg, var(--bg), #E6DFD9 60%, #EAE5E0 100%);
      background-attachment: fixed; }

    /* ì¹´ë“œ & ì»¨í…Œì´ë„ˆ */
    .container{ max-width: 920px; margin: 0 auto; padding: 24px; }
    .hero{ border-radius: 28px; background: linear-gradient(180deg, var(--paper), var(--card)); box-shadow: var(--shadow-1); padding: 24px; display:flex; align-items:center; gap:16px; border:1px solid var(--line); position:relative; overflow:hidden; }
    .hero::after{ content:""; position:absolute; inset:0; background: radial-gradient(600px 220px at -10% -20%, rgba(255,255,255,.7), transparent 60%); pointer-events:none; }
    .avatar{ width:64px; height:64px; border-radius:50%; background: linear-gradient(180deg,#cfc7c0,#b9b1aa); box-shadow: 0 4px 10px rgba(60,50,42,.18) ; display:grid; place-items:center; font-weight:700; color:#fff; letter-spacing:.5px; }

    .panel{ border-radius: 22px; background: linear-gradient(180deg, var(--paper), var(--card)); border:1px solid var(--line); box-shadow: var(--shadow-1); padding: 20px; }
    .section-title{ font-weight:600; font-size: 1.05rem; }
    .label{ color:var(--sub); font-size:.85rem; }

    /* ë²„íŠ¼ */
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.75rem 1.05rem; border-radius:14px; border:1px solid rgba(0,0,0,.04); box-shadow: var(--inner), 0 6px 18px rgba(73,56,43,.12); font-weight:600; transition: all .18s ease; }
    .btn:focus{ outline: none; box-shadow: 0 0 0 4px var(--ring), var(--inner), 0 6px 18px rgba(73,56,43,.12); }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn-primary{ background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#fff; }
    .btn-ghost{ background: linear-gradient(180deg,#F4F0EC,#ECE6E1); color:var(--ink); }

    /* ì…ë ¥ */
    .file-wrap{ display:flex; gap:.6rem; flex-wrap:wrap; }
    .chip{ display:inline-flex; align-items:center; gap:.5rem; padding:.6rem 1rem; border-radius:14px; background: linear-gradient(180deg,#F4F0EC,#ECE6E1); border:1px solid var(--line); box-shadow: var(--inner); font-weight:600; }
    .file-input{ display:none; }
    .file-label{ cursor:pointer; }

    /* ë¯¸ë¦¬ë³´ê¸° */
    .preview{ aspect-ratio: 1/1; width:100%; border-radius: 20px; background: #F0ECE8; border:1px solid var(--line); display:grid; place-items:center; overflow:hidden; }
    .preview img{ max-height: 420px; object-fit: contain; }

    /* ê²°ê³¼ ì¹´ë“œ ë‚´ë¶€ */
    .pill{ display:inline-block; padding:.2rem .55rem; border-radius:999px; background:#EFE8E2; border:1px solid var(--line); font-size:.78rem; margin:.1rem .2rem .1rem 0; }
  </style>
</head>
<body>
  <main class="container">
    <!-- HERO -->
    <section class="hero">
      <div class="avatar">W</div>
      <div>
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">ì›¹ ì´ë¯¸ì§€ ì»¨ì„¤í„´íŠ¸ <span class="opacity-80">(ë°°ìš°/ëª¨ë¸)</span></h1>
        <p class="label mt-1">ì‚¬ì§„(ì¹´ë©”ë¼/ì•¨ë²”)ì„ ì—…ë¡œë“œí•˜ë©´ ì²«ì¸ìƒÂ·í—¤ì–´Â·í”¼ë¶€Â·ë©”ì´í¬ì—… ìƒíƒœì™€ ë§ì¶¤ ì¶”ì²œì„ ì œê³µí•©ë‹ˆë‹¤.</p>
      </div>
    </section>

    <!-- ì—…ë¡œë“œ -->
    <section class="panel mt-5">
      <div class="flex items-center justify-between">
        <h2 class="section-title">ì‚¬ì§„ ì—…ë¡œë“œ</h2>
        <span class="label">ì¹´ë©”ë¼ ì´¬ì˜ ë˜ëŠ” ì•¨ë²”ì—ì„œ ì„ íƒ</span>
      </div>
      <div class="grid md:grid-cols-2 gap-5 mt-4 items-start">
        <div>
          <div class="file-wrap">
            <label for="fileInput" class="chip file-label">ğŸ“· ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸°</label>
            <button id="analyzeBtn" class="btn btn-primary">AI ë¶„ì„í•˜ê¸°</button>
            <button id="clearBtn" class="btn btn-ghost">ì§€ìš°ê¸°</button>
          </div>
          <input id="fileInput" class="file-input" type="file" accept="image/*" capture="environment"/>
          <p class="label mt-3">â€» ì´ˆìƒê¶Œ/ì €ì‘ê¶Œì„ ì¹¨í•´í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>
        </div>
        <div>
          <div class="preview">
            <img id="previewImage" alt="ë¯¸ë¦¬ë³´ê¸°" class="hidden"/>
            <div id="placeholder" class="label">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ê²°ê³¼ -->
    <section id="resultSection" class="panel mt-5 hidden">
      <div class="flex items-center justify-between">
        <h2 class="section-title">ë¶„ì„ ê²°ê³¼</h2>
        <button id="copyBtn" class="btn btn-ghost">ë³µì‚¬í•˜ê¸°</button>
      </div>
      <div id="summary" class="mt-3 p-4 rounded-xl border border-[color:var(--line)] bg-[#F5F1ED]"></div>

      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <div id="feelsCard" class="p-4 rounded-xl border border-[color:var(--line)] bg-[#F7F3EF]"></div>
        <div id="hairCard" class="p-4 rounded-xl border border-[color:var(--line)] bg-[#F7F3EF]"></div>
        <div id="skinCard" class="p-4 rounded-xl border border-[color:var(--line)] bg-[#F7F3EF]"></div>
        <div id="makeupCard" class="p-4 rounded-xl border border-[color:var(--line)] bg-[#F7F3EF]"></div>
      </div>

      <div id="dosCard" class="p-4 rounded-xl border border-[color:var(--line)] bg-[#F5F1ED] mt-4"></div>
    </section>

    <!-- ë¡œë”© & ë©”ì‹œì§€ -->
    <div id="overlay" class="fixed inset-0 hidden bg-black/35 grid place-items-center z-50">
        <div id="loadingIndicator" class="panel w-[320px] text-center">
            <div class="mx-auto mb-3 w-10 h-10 rounded-full border-4 border-[color:var(--accent)] border-t-transparent animate-spin"></div>
            <div class="font-medium">AI ë¶„ì„ ì¤‘â€¦</div>
            <div class="label mt-1">ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ ìˆ˜ ì´ˆê°€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
        <div id="messageBox" class="panel w-[320px] text-center hidden">
             <h3 class="font-medium text-lg mb-2">ì•Œë¦¼</h3>
             <p id="messageText" class="mb-4"></p>
             <button id="messageCloseBtn" class="btn btn-primary">í™•ì¸</button>
        </div>
    </div>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);

    // --- ì„¤ì • ---
    // ì—¬ê¸°ì— ì œê³µë°›ì€ API í‚¤ë¥¼ ì§ì ‘ ì…ë ¥í•©ë‹ˆë‹¤.
    // ì£¼ì˜: ì´ ë°©ì‹ì€ í…ŒìŠ¤íŠ¸ìš©ì´ë©°, ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ë¥¼ í†µí•´ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ ì•ˆì „í•©ë‹ˆë‹¤.
    const API_KEY = 'AIzaSyBJEtwmOTMo1yB3VtfGre72AOIxZKpi8SU';
    const MODEL = 'gpt-4o-mini';

    // UI ìš”ì†Œ
    const fileInput = $('#fileInput');
    const previewImage = $('#previewImage');
    const placeholder = $('#placeholder');
    const analyzeBtn = $('#analyzeBtn');
    const clearBtn = $('#clearBtn');
    
    // ì˜¤ë²„ë ˆì´ ë° ë©”ì‹œì§€ ë°•ìŠ¤
    const overlay = $('#overlay');
    const loadingIndicator = $('#loadingIndicator');
    const messageBox = $('#messageBox');
    const messageText = $('#messageText');
    const messageCloseBtn = $('#messageCloseBtn');

    // ê²°ê³¼ ì„¹ì…˜
    const resultSection = $('#resultSection');
    const summary = $('#summary');
    const feelsCard = $('#feelsCard');
    const hairCard = $('#hairCard');
    const skinCard = $('#skinCard');
    const makeupCard = $('#makeupCard');
    const dosCard = $('#dosCard');
    const copyBtn = $('#copyBtn');

    let imageBase64 = null;
    
    // --- ë©”ì‹œì§€ ë°•ìŠ¤ ê´€ë ¨ í•¨ìˆ˜ ---
    function showMessage(msg) {
        messageText.textContent = msg;
        loadingIndicator.classList.add('hidden');
        messageBox.classList.remove('hidden');
        overlay.classList.remove('hidden');
    }
    
    messageCloseBtn.addEventListener('click', () => {
        overlay.classList.add('hidden');
        messageBox.classList.add('hidden');
    });

    // --- UI ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    clearBtn.addEventListener('click', () => {
      fileInput.value = '';
      imageBase64 = null;
      previewImage.src = '';
      previewImage.classList.add('hidden');
      placeholder.classList.remove('hidden');
      resultSection.classList.add('hidden');
      analyzeBtn.disabled = false;
    });

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      
      try {
        const url = URL.createObjectURL(file);
        previewImage.src = url;
        previewImage.onload = () => URL.revokeObjectURL(url);
        previewImage.classList.remove('hidden');
        placeholder.classList.add('hidden');
        imageBase64 = await toBase64(file);
      } catch (err) {
        console.error("File processing error:", err);
        showMessage("íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });

    analyzeBtn.addEventListener('click', async () => {
      if (!imageBase64) {
        showMessage('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      if (!API_KEY || API_KEY === 'AIzaSyBJEtwmOTMo1yB3VtfGre72AOIxZKpi8SU') {
        showMessage('ì£¼ì˜: ì½”ë“œì— ìœ íš¨í•œ OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ í‚¤ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.');
        return;
      }

      analyzeBtn.disabled = true;
      messageBox.classList.add('hidden');
      loadingIndicator.classList.remove('hidden');
      overlay.classList.remove('hidden');

      try {
        const data = await callOpenAI(imageBase64, API_KEY, MODEL);
        const parsed = extractJSON(data);
        renderResult(parsed);
      } catch (err) {
        console.error(err);
        showMessage(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}`);
      } finally {
        overlay.classList.add('hidden');
        analyzeBtn.disabled = false;
      }
    });

    copyBtn.addEventListener('click', async () => {
      try {
        const txt = buildClipboardText();
        await navigator.clipboard.writeText(txt);
        copyBtn.textContent = 'ë³µì‚¬ë¨!';
        setTimeout(() => copyBtn.textContent = 'ë³µì‚¬í•˜ê¸°', 1200);
      } catch { 
        showMessage('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); 
      }
    });

    // --- í”„ë¡¬í”„íŠ¸ ë° API í˜¸ì¶œ ---
    function buildPrompt() {
      return `ë‹¹ì‹ ì€ ìƒì—… ê´‘ê³ Â·ìºìŠ¤íŒ… ê²½í—˜ì´ í’ë¶€í•œ ì´ë¯¸ì§€ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.\n\n- í•œêµ­ì–´ë¡œë§Œ ë‹µí•˜ê³ , ë°˜ë“œì‹œ JSON ê°ì²´ë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n- ì§ì„¤ì ì´ê³  ì‹¤ë¬´ í†¤ì„ ìœ ì§€í•˜ë©°, ê³¼ì¥ë˜ê±°ë‚˜ ëª¨í˜¸í•œ í‘œí˜„ì€ í”¼í•˜ì„¸ìš”.\n- ì‚¬ì§„ ì† ì¸ë¬¼ì˜ ì²«ì¸ìƒ/ë¬´ë“œ, í—¤ì–´, í”¼ë¶€, ë©”ì´í¬ì—…ì„ ì¤‘ì‹¬ìœ¼ë¡œ í‰ê°€ì™€ ê°œì„ ì•ˆì„ ë‚˜ëˆ„ì–´ ì œì‹œí•©ë‹ˆë‹¤.\n- ë°°ìš°/ëª¨ë¸ì´ í˜„ì¥ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ì œí’ˆ/í†¤/í—¤ì–´ì»· ëª…ì¹­ ë“± êµ¬ì²´ì ì¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.\n\nì¶œë ¥ ìŠ¤í‚¤ë§ˆ(JSON)ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n{\n  "summary": "ì¢…í•© ìš”ì•½",\n  "mood": { "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"], "why": "í‚¤ì›Œë“œ ì„ ì • ì´ìœ " },\n  "hair": { "state": "í˜„ì¬ ìƒíƒœ", "issues": ["ë¬¸ì œì 1"], "recommendations": ["ê°œì„  ì œì•ˆ1"] },\n  "skin": { "state": "í˜„ì¬ ìƒíƒœ", "issues": ["ë¬¸ì œì 1"], "recommendations": ["ê°œì„  ì œì•ˆ1"] },\n  "makeup": { "state": "í˜„ì¬ ìƒíƒœ", "issues": ["ë¬¸ì œì 1"], "recommendations": ["ê°œì„  ì œì•ˆ1"] },\n  "dos": ["ì¶”ì²œ ì‚¬í•­1"],\n  "donts": ["í”¼í•´ì•¼ í•  ì‚¬í•­1"]\n}\n\nì£¼ì˜: ì£¼ë³€ ë°°ê²½/ì‚¬ë¬¼ì— ëŒ€í•œ ì¶”ì •ì€ ê³¼ë„í•˜ê²Œ í•˜ì§€ ë§ê³ , ì¸ë¬¼ ì™¸ ìš”ì†Œ ì–¸ê¸‰ì€ ìµœì†Œí™”í•˜ì„¸ìš”.`;
    }

    async function callOpenAI(imageBase64, apiKey, model) {
        const apiUrl = 'https://api.openai.com/v1/chat/completions';
        const body = {
            model: model,
            messages: [{
                role: 'user',
                content: [
                    { type: 'text', text: buildPrompt() },
                    { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${imageBase64}` } }
                ]
            }],
            max_tokens: 1500,
            response_format: { type: 'json_object' }
        };

        const r = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
            body: JSON.stringify(body)
        });

        if (!r.ok) {
            const errorBody = await r.json();
            console.error('OpenAI API Error:', errorBody);
            throw new Error(`OpenAI ìš”ì²­ ì‹¤íŒ¨: ${errorBody.error.message}`);
        }
        return await r.json();
    }

    function extractJSON(apiResponse) {
      let txt = '';
      if (apiResponse?.choices?.[0]?.message?.content) {
          txt = apiResponse.choices[0].message.content;
      }
      try {
          return JSON.parse(txt);
      } catch (e) {
          console.error('JSON íŒŒì‹± ì‹¤íŒ¨. ì›ë¬¸:', txt, e);
          return { summary: `ì˜¤ë¥˜: ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›ë¬¸: ${txt}`, mood:{ keywords:[], why:'' }, hair: emptySec(), skin: emptySec(), makeup: emptySec(), dos:[], donts:[] };
      }
    }

    function emptySec(){ return { state:'', issues:[], recommendations:[] }; }

    // --- ë Œë”ë§ í•¨ìˆ˜ ---
    function renderResult(d){
      resultSection.classList.remove('hidden');
      summary.innerHTML = `<div>${escapeHTML(d.summary || 'ìš”ì•½ ì—†ìŒ')}</div>`;

      const pills = (arr=[]) => arr.map(k=>`<span class='pill'>${escapeHTML(k)}</span>`).join('');

      feelsCard.innerHTML = sectionHTML('ì²«ì¸ìƒ Â· ë¬´ë“œ', `<div><b>í‚¤ì›Œë“œ</b>: ${pills(d.mood?.keywords)}<div class='mt-2'>${escapeHTML(d.mood?.why||'')}</div></div>`);
      hairCard.innerHTML  = sectionHTML('í—¤ì–´ìŠ¤íƒ€ì¼', blockSet(d.hair));
      skinCard.innerHTML  = sectionHTML('í”¼ë¶€ ìƒíƒœ', blockSet(d.skin));
      makeupCard.innerHTML= sectionHTML('ë©”ì´í¬ì—…', blockSet(d.makeup));

      dosCard.innerHTML = sectionHTML('ì œì•ˆ / í”¼í•´ì•¼ í•  ê²ƒ', `
        <div class='grid md:grid-cols-2 gap-4'>
          <div>
            <div class='font-semibold mb-2'>ì œì•ˆ(Do)</div>
            <ul class='list-disc list-inside space-y-1'>${(d.dos||[]).map(li=>`<li>${escapeHTML(li)}</li>`).join('')}</ul>
          </div>
          <div>
            <div class='font-semibold mb-2'>í”¼í•´ì•¼ í•  ê²ƒ(Don't)</div>
            <ul class='list-disc list-inside space-y-1'>${(d.donts||[]).map(li=>`<li>${escapeHTML(li)}</li>`).join('')}</ul>
          </div>
        </div>`);
        
        resultSection.scrollIntoView({ behavior: 'smooth' });
    }

    function sectionHTML(title, inner){
      return `<div><div class='label mb-1'>${title}</div>${inner}</div>`;
    }

    function blockSet(sec){
      return `
        <div class='space-y-2'>
          <div><span class='label'>ìƒíƒœ</span><div>${escapeHTML(sec?.state||'')}</div></div>
          <div><span class='label'>ì´ìŠˆ</span><ul class='list-disc list-inside space-y-1'>${(sec?.issues||[]).map(x=>`<li>${escapeHTML(x)}</li>`).join('')}</ul></div>
          <div><span class='label'>ì¶”ì²œ</span><ul class='list-disc list-inside space-y-1'>${(sec?.recommendations||[]).map(x=>`<li>${escapeHTML(x)}</li>`).join('')}</ul></div>
        </div>`;
    }

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function buildClipboardText() {
        let text = `[ì›¹ ì´ë¯¸ì§€ ì»¨ì„¤íŒ… ê²°ê³¼]\n\n`;
        text += `ìš”ì•½:\n${summary.innerText}\n\n`;
        text += `ì²«ì¸ìƒ Â· ë¬´ë“œ:\n${feelsCard.innerText}\n\n`;
        text += `í—¤ì–´ìŠ¤íƒ€ì¼:\n${hairCard.innerText}\n\n`;
        text += `í”¼ë¶€ ìƒíƒœ:\n${skinCard.innerText}\n\n`;
        text += `ë©”ì´í¬ì—…:\n${makeupCard.innerText}\n\n`;
        text += `ì œì•ˆ / í”¼í•´ì•¼ í•  ê²ƒ:\n${dosCard.innerText}`;
        return text;
    }

    function toBase64(file){
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });
    }

    function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[m])); }
  </script>
</body>
</html>

